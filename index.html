<!DOCTYPE html>
<html lang="ml">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Poster Maker</title>

<style>
@font-face{
  font-family:'Malayalam';
  src:url('fonts/NotoSansMalayalam-Regular.ttf');
}
body{
  font-family:Arial, sans-serif;
  background:#f2f2f2;
  padding:10px;
}
input,button,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:16px;
}
button{
  background:#0a7cff;
  color:#fff;
  border:none;
  border-radius:6px;
}
.section{
  background:#fff;
  padding:10px;
  border-radius:6px;
  margin-bottom:10px;
}
.list-item{
  border-bottom:1px solid #ddd;
  padding:6px 0;
  font-size:14px;
}
.list-item button{margin-left:6px;}
img{width:100%;margin-top:10px;}
canvas{display:none;}
.small{font-size:13px;color:#555;}

.page-footer{
  margin-top:20px;
  text-align:center;
  font-size:18px;
}
.page-footer a{
  color:#0a7cff;
  text-decoration:none;
  font-weight:bold;
}
</style>
</head>

<body>

<h3>üñºÔ∏è Daily Price Poster Maker</h3>

<!-- ADD ITEM -->
<div class="section">
<h4>‚ûï Daily Item</h4>

<input type="file" id="photo" accept="image/*" capture="environment">

<input list="mlList" id="nameML" placeholder="‡¥á‡¥®‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥™‡µá‡¥∞‡µç (Malayalam)">
<datalist id="mlList"></datalist>

<input id="nameEN" placeholder="Item Name (English)">
<input id="price" placeholder="‡¥µ‡¥ø‡¥≤ (‚Çπ / Kg)">

<button onclick="addItem()">‚ûï Add Item</button>
<div class="small">‚ÑπÔ∏è Item name ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç pre-list-‡µΩ save ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥Ç</div>
</div>

<!-- TODAY ITEMS -->
<div class="section">
<h4>üìã Today Items</h4>
<div id="itemList"></div>
</div>

<!-- PRE-LIST -->
<div class="section">
<h4>üóÇÔ∏è Pre-List (Memory)</h4>
<input placeholder="üîç Search"
       oninput="renderPreList(this.value)">
<div id="preListManager"></div>
</div>

<!-- SIZE -->
<div class="section">
<h4>üìê WhatsApp Size</h4>
<select id="waSize">
  <option value="status">WhatsApp Status (9:16)</option>
  <option value="chat">WhatsApp Chat (4:5)</option>
</select>
</div>

<button onclick="generatePoster()">üñºÔ∏è Generate Poster</button>

<img id="preview">
<canvas id="canvas"></canvas>

<!-- PAGE FOOTER LINK -->
<div class="page-footer">
  ‡¥ì‡µ∫‡¥≤‡µà‡¥®‡¥ø‡µΩ ‡¥µ‡¥æ‡¥ô‡µç‡¥ô‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡¥æ‡¥Ø‡¥ø
  <a href="https://www.kfmaco.in" target="_blank">
    www.kfmaco.in
  </a>
  ‡¥∏‡¥®‡µç‡¥¶‡µº‡¥∂‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï
</div>

<script>
let items=[];
let preList=[];
const KEY="DAILY_POSTER_PRELIST_V1";

const mlInput=nameML, enInput=nameEN, priceInput=price;
const mlList=document.getElementById("mlList");
const itemListDiv=document.getElementById("itemList");
const preListManager=document.getElementById("preListManager");

function loadPreList(){
  try{
    const r=localStorage.getItem(KEY);
    preList=r?JSON.parse(r):[];
    if(!Array.isArray(preList)) preList=[];
  }catch{preList=[];}
}
function savePreList(){
  localStorage.setItem(KEY,JSON.stringify(preList));
  rebuildPreList();
}
function rebuildPreList(){
  mlList.innerHTML="";
  preList.forEach(it=>{
    const o=document.createElement("option");
    o.value=it.ml; mlList.appendChild(o);
  });
  renderPreList("");
}
document.addEventListener("DOMContentLoaded",()=>{
  loadPreList(); rebuildPreList();
});

mlInput.addEventListener("input",()=>{
  const f=preList.find(i=>i.ml===mlInput.value.trim());
  enInput.value=f?f.en:"";
});

function addItem(){
  const ml=mlInput.value.trim();
  const en=enInput.value.trim();
  const pr=priceInput.value.trim();
  const ph=photo.files[0];
  if(!ml||!en||!pr||!ph){alert("‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥Ç ‡¥®‡µΩ‡¥ï‡¥£‡¥Ç");return;}
  items.push({ml,en,price:pr,photo:ph});
  if(!preList.find(i=>i.ml===ml)){
    preList.push({ml,en}); savePreList();
  }
  mlInput.value=enInput.value=priceInput.value="";
  photo.value="";
  renderToday();
}
function renderToday(){
  itemListDiv.innerHTML="";
  items.forEach((it,i)=>{
    itemListDiv.innerHTML+=`
      <div class="list-item">
        ${it.ml} ‚Äì ${it.en} ‚Äì ‚Çπ${it.price}
        <button onclick="items.splice(${i},1);renderToday()">‚ùå</button>
      </div>`;
  });
}
function renderPreList(q){
  q=q.toLowerCase();
  preListManager.innerHTML="";
  preList.forEach(it=>{
    if(it.ml.toLowerCase().includes(q)||it.en.toLowerCase().includes(q)){
      preListManager.innerHTML+=`
        <div class="list-item">
          ${it.ml} ‚Äì ${it.en}
          <button onclick="mlInput.value='${it.ml}';enInput.value='${it.en}'">‚ûï Today</button>
        </div>`;
    }
  });
}

function generatePoster(){
  if(!items.length){alert("‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥á‡¥≤‡µç‡¥≤");return;}
  const mode=waSize.value;
  const W=1080, Hh=mode==="status"?280:220, Fh=200, top=60, gap=24;
  let hs=[], ld=0;

  items.forEach((it,i)=>{
    const im=new Image();
    im.onload=()=>{
      hs[i]=W/(im.width/im.height);
      if(++ld===items.length) draw();
    };
    im.src=URL.createObjectURL(it.photo);
  });

  function draw(){
    let TH=Hh+top+Fh; hs.forEach(h=>TH+=h+gap);
    canvas.width=W; canvas.height=TH;
    const c=canvas.getContext("2d");
    c.fillStyle="#fff"; c.fillRect(0,0,W,TH);

    const h=new Image();
    h.onload=()=>{
      c.drawImage(h,0,0,W,Hh);
      c.fillStyle="rgba(0,0,0,.55)";
      c.fillRect((W-360)/2,24,360,70);
      c.fillStyle="#fff"; c.font="bold 36px Arial";
      c.textAlign="center";
      c.fillText(new Date().toLocaleDateString("en-GB"),W/2,72);
      c.textAlign="left";

      let y=Hh+top;
      items.forEach((it,i)=>{
        const im=new Image();
        im.onload=()=>{
          const hgt=hs[i];
          c.drawImage(im,0,y,W,hgt);
          c.fillStyle="rgba(0,0,0,.6)";
          c.fillRect(0,y+hgt-160,W,160);
          c.fillStyle="#fff";
          c.font="bold 56px Malayalam";
          c.fillText(it.ml,30,y+hgt-95);
          c.font="34px Arial";
          c.fillText(it.en,30,y+hgt-45);
          c.font="bold 54px Arial";
          c.textAlign="right";
          c.fillText("‚Çπ "+it.price,W-30,y+hgt-95);
          c.textAlign="left";
        };
        im.src=URL.createObjectURL(it.photo);
        y+=hs[i]+gap;
      });

      c.fillStyle="#111";
      c.fillRect(0,TH-Fh,W,Fh);
      c.fillStyle="#fff";
      c.font="bold 48px Malayalam";
      c.textAlign="center";
      c.fillText(
        "‡¥π‡µã‡¥Ç ‡¥°‡µÜ‡¥≤‡¥ø‡¥µ‡¥±‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø ‡¥µ‡¥ø‡¥≥‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï  9846 606 609",
        W/2, TH-100
      );
      c.textAlign="left";
      preview.src=canvas.toDataURL("image/jpeg",1);
    };
    h.src="header.jpg";
  }
}
</script>

</body>
</html>
